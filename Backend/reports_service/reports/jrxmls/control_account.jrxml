<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.20.5.final using JasperReports Library version 6.20.5-3efcf2e67f959db3888d79f73dde2dbd7acb4f8e  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Blank_A4" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="8c24895a-f11f-4915-ae14-344641fa37b9">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="Mariadb Goodway"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w1" value="0"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w2" value="1000"/>
	<parameter name="to_date" class="java.lang.String"/>
	<parameter name="report_icon" class="java.lang.String"/>
	<parameter name="sacco_name" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
    subHeadDescription,
    SUM(totalBalance) AS totalBalance
FROM
    (SELECT
        glsubhead.gl_subhead_description AS subHeadDescription,
        ROUND(SUM(pbal.bal), 2) AS totalBalance
    FROM
        accounts
    INNER JOIN
        (SELECT
            DISTINCT pt.acid,
            SUM(CAST((CASE WHEN pt.part_tran_type = 'Debit' THEN -pt.tran_amount ELSE pt.tran_amount END) AS DECIMAL(65, 2))) AS bal
        FROM
            part_tran pt
            JOIN dtd ON pt.transaction_header_id = dtd.sn AND dtd.posted_flag = 'Y'
        WHERE
             DATE(pt.tran_date) <= DATE($P{to_date})
            AND (
                dtd.reversal_posted_flag IS NULL
                OR dtd.reversal_posted_flag = 'N'
                OR (dtd.reversal_posted_flag <> 'Y' AND dtd.reversed_flag <> 'Y')
            )
            AND pt.tran_particulars <> 'EndOfYearReconciliation'
        GROUP BY pt.acid
        ) AS pbal ON accounts.acid = pbal.acid
    INNER JOIN
        (SELECT *
        FROM glsubhead
        WHERE gl_code IN (
            SELECT gl_code
            FROM gl
            WHERE classification = 'INCOMES'
            AND gl_subhead_code = '301'
        )) glsubhead ON glsubhead.gl_subhead_code = accounts.gl_subhead
    GROUP BY glsubhead.gl_subhead_description
) AS combined_data
UNION ALL
SELECT
    'Non-Withdrawable Deposits' AS subHeadDescription,
    ROUND(SUM(pt.Balance), 2) AS totalBalance
FROM
    (
        SELECT
            a.acid,
            SUM(CASE WHEN pt.part_tran_type = 'Debit' THEN -1 * pt.tran_amount ELSE pt.tran_amount END) AS Balance
        FROM
            part_tran pt
            JOIN dtd ON pt.transaction_header_id = dtd.sn
            JOIN accounts a ON a.acid = pt.acid
        WHERE
            dtd.deleted_flag = 'N'
            AND dtd.posted_flag = 'Y'
            AND (
                dtd.reversal_posted_flag IS NULL
                OR dtd.reversal_posted_flag = 'N'
                OR (dtd.reversal_posted_flag <> 'Y' AND dtd.reversed_flag <> 'Y')
            )
            AND DATE(pt.tran_date) <= DATE($P{to_date})
        GROUP BY
            a.acid
    ) AS pt
    JOIN accounts a ON pt.acid = a.acid
WHERE
    a.account_type = 'SBA'
    AND a.product_code = 'S02'
UNION ALL
    
SELECT
    'total shares' AS subHeadDescription,
    ROUND(SUM(pt.Balance), 2) AS totalBalance
FROM
    (
        SELECT
            a.acid,
            SUM(CASE WHEN pt.part_tran_type = 'Debit' THEN -1 * pt.tran_amount ELSE pt.tran_amount END) AS Balance
        FROM
            part_tran pt
            JOIN dtd ON pt.transaction_header_id = dtd.sn
            JOIN accounts a ON a.acid = pt.acid
        WHERE
            dtd.deleted_flag = 'N'
            AND dtd.posted_flag = 'Y'
            AND (
                dtd.reversal_posted_flag IS NULL
                OR dtd.reversal_posted_flag = 'N'
                OR (dtd.reversal_posted_flag <> 'Y' AND dtd.reversed_flag <> 'Y')
            )
            AND DATE(pt.tran_date) <= DATE($P{to_date})
        GROUP BY
            a.acid
    ) AS pt
    JOIN accounts a ON pt.acid = a.acid
WHERE  gl_subhead = 500
UNION ALL
SELECT 
    'Total Loan Portfolio' AS subHeadDescription,
    ROUND(SUM(ac.account_balance), 2) AS totalBalance
FROM 
    loan ln 
JOIN 
    (
        SELECT * 
        FROM accounts 
        WHERE account_type = 'laa' 
            AND account_balance < 0 
            AND DATE(opening_date) <=DATE($P{to_date})
    ) ac 
ON 
    ac.id = ln.account_id_fk;]]>
	</queryString>
	<field name="subHeadDescription" class="java.lang.String"/>
	<field name="totalBalance" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="140" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<image hAlign="Center" vAlign="Middle">
				<reportElement x="0" y="-10" width="130" height="134" uuid="f6a6b7f2-309c-4d38-88f5-255be3403558">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<imageExpression><![CDATA[$P{report_icon}]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="230" y="53" width="192" height="27" uuid="2254cc5f-8885-458e-b2e8-c1fe2cab5414">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Control Account]]></text>
			</staticText>
			<line>
				<reportElement x="5" y="129" width="555" height="1" uuid="e5745613-060d-4805-8f2a-4b94367abd3e">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<graphicElement>
					<pen lineWidth="2.0"/>
				</graphicElement>
			</line>
			<textField>
				<reportElement mode="Transparent" x="150" y="-4" width="417" height="44" forecolor="#030200" uuid="28a4f2d9-73c7-468c-bbd1-c464663b11aa">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle" rotation="None" markup="none">
					<font size="24" isBold="true"/>
					<paragraph lineSpacingSize="1.0"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{sacco_name}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="326" y="89" width="83" height="27" uuid="594dc3a8-f930-4063-8d01-e8b4adf0a347"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$P{to_date}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="220" y="89" width="93" height="27" uuid="6c7a455b-7096-402e-a4e4-0720d3650926">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Date]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="25" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<staticText>
				<reportElement x="0" y="0" width="310" height="20" uuid="096f4cdb-107d-49b2-9a6b-ec42f368f632">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Items]]></text>
			</staticText>
			<staticText>
				<reportElement x="310" y="0" width="230" height="20" uuid="bd6638c5-a23d-4655-98b6-bb1c40726919">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box rightPadding="4">
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Total Amount]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="21" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<textField textAdjust="StretchHeight">
				<reportElement stretchType="RelativeToTallestObject" x="0" y="0" width="310" height="20" uuid="7e2058e4-3912-4de1-9ae5-b6f9e911ed8d">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box topPadding="3" bottomPadding="3">
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{subHeadDescription}]]></textFieldExpression>
			</textField>
			<textField textAdjust="StretchHeight" pattern="#,##0.00">
				<reportElement stretchType="RelativeToTallestObject" x="310" y="1" width="230" height="20" uuid="9dc94bb6-5e21-4933-acaa-58e535ce5991">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box topPadding="3" bottomPadding="3" rightPadding="5">
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{totalBalance}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="20" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
		</band>
	</summary>
</jasperReport>
