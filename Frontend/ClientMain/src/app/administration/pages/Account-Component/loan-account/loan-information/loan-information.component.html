<mat-card>
  <mat-card-header class="breadcrumb">
    <div><a routerLink="/system">Dashboard / </a>Loans Accounts Information</div>
  </mat-card-header>
  <div *ngIf="loading">
    <p><small>Processing, please wait...</small></p>
    <p>
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </p>
  </div>
  <div class="row">
    <div class="col-md-6 col-sm-12">
      <h4>Function:- <strong>LOAN ACCOUNTS INFORMATION</strong></h4>
    </div>
  </div>
  <div class="container-fluid">
    <mat-tab-group mat-align-tabs="center">
      <mat-tab class="mat-tab container-fluid" label="LOAN ACCRUAL">
        <br>
        <h4 class="float-left"><strong>Loan Accrual</strong></h4>
        <h4 class="float-right">Total Loan Accounts Accrued: <strong *ngIf="onDisplay">_ _ _</strong> <strong
            *ngIf="onEnabled">{{this.total_accrual}}</strong></h4>
        <div class="row">
          <div class="col-md-6 col-sm-12">
            <div class="form-group">
              <div class="col-md-6 col-sm-12 form-column">
                <label for="" class="start">Choose Date<span class="warning">*</span></label>
              </div>
              <div class="col-md-6 col-sm-12 form-column">
                <input [matDatepicker]="AccrualDate" class="form-control" (dateChange)="loanDateEvent($event)"
                  [ngModel]="date">
                <mat-datepicker-toggle matSuffix [for]="AccrualDate"></mat-datepicker-toggle>
                <mat-datepicker #AccrualDate></mat-datepicker>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-12">
            <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getNotAccruedEvents()">
              SUBMIT
            </button>
          </div>
          <div class="col-md-4 col-sm-12">
            <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getTotalAccruals()">
              Total Loans Accounts Accrued Per Date
            </button>
          </div>
        </div>
        <br>
        <mat-divider *ngIf="onDisplayLoansNotAccrued"></mat-divider>
        <br>
        <h4 class="text-center" *ngIf="onDisplayLoansNotAccrued"><strong>LOANS ACCOUNTS NOT ACCRUED</strong></h4>
        <table class="table table-striped table-bordered table-sm row-border hover" style="width: 100%;"
          *ngIf="onDisplayLoansNotAccrued">
          <thead>
            <tr>
              <th>No.</th>
              <th>Account Id</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of this.not_accrued, let i = index">
              <td>{{i + 1}}</td>
              <td>{{item.acid}}</td>
            </tr>
          </tbody>
        </table>
      </mat-tab>
      <mat-tab class="mat-tab container-fluid" label="LOAN BOOKINGS">
        <br>
        <h4 class="float-left"><strong>Loan Bookings</strong></h4>
        <h4 class="float-right">Total Loan Accounts Booked: <strong *ngIf="onDisplay">_ _ _</strong> <strong
            *ngIf="onEnabled">{{this.total_bookings}}</strong></h4>
        <div class="row">
          <div class="col-md-6 col-sm-12">
            <div class="form-group">
              <div class="col-md-6 col-sm-12 form-column">
                <label for="" class="start">Choose Date<span class="warning">*</span></label>
              </div>
              <div class="col-md-6 col-sm-12 form-column">
                <input [matDatepicker]="bookingDate" class="form-control" (dateChange)="loanDateEvent($event)"
                  [ngModel]="generation_date">
                <mat-datepicker-toggle matSuffix [for]="bookingDate"></mat-datepicker-toggle>
                <mat-datepicker #bookingDate></mat-datepicker>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-12">
            <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getNotBookedEvents()">
              SUBMIT
            </button>
          </div>
          <div class="col-md-4 col-sm-12">
            <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getTotalBookings()">
              Total Loans Accounts Booked Per Date
            </button>
          </div>
        </div>
        <br>
        <mat-divider *ngIf="onDisplayLoansNotBooked"></mat-divider>
        <br>
        <h4 class="text-center" *ngIf="onDisplayLoansNotBooked"><strong>LOANS ACCOUNTS NOT BOOKED</strong></h4>
        <table class="table table-striped table-bordered table-sm row-border hover" style="width: 100%;"
          *ngIf="onDisplayLoansNotBooked">
          <thead>
            <tr>
              <th>No.</th>
              <th>Account Id</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of this.notBooked, let i = index">
              <td>{{i + 1}}</td>
              <td>{{item.acid}}</td>
            </tr>
          </tbody>
        </table>
      </mat-tab>
      <mat-tab class="mat-tab container-fluid" label="LOAN DEMANDS">
        <br>
        <h4 class="float-left"><strong>Loan Demands</strong></h4>
        <h4 class="float-right">Total Demands Generated Accounts: <strong *ngIf="onDisplay">_ _ _</strong> <strong
            *ngIf="onEnabled">{{this.total_demands}}</strong></h4>
        <div class="row">
          <div class="col-md-6 col-sm-12">
            <div class="form-group">
              <div class="col-md-6 col-sm-12 form-column">
                <label for="" class="start">Choose Date<span class="warning">*</span></label>
              </div>
              <div class="col-md-6 col-sm-12 form-column">
                <input [matDatepicker]="demandedDate" class="form-control" (dateChange)="loanDateEvent($event)"
                  [ngModel]="generation_date">
                <mat-datepicker-toggle matSuffix [for]="demandedDate"></mat-datepicker-toggle>
                <mat-datepicker #demandedDate></mat-datepicker>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-12">
            <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getNotDemandedEvents()">
              SUBMIT
            </button>
          </div>
          <div class="col-md-4 col-sm-12">
            <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getTotalADemands()">
              Total Demands Per Date
            </button>
          </div>
        </div>
        <br>
        <mat-divider *ngIf="onDisplayLoansDemands"></mat-divider>
        <br>
        <h4 class="text-center" *ngIf="onDisplayLoansDemands"><strong>LOANS ACCOUNTS WHOSE DEMANDS NOT GENERATED</strong></h4>
        <table class="table table-striped table-bordered table-sm row-border hover" style="width: 100%;"
          *ngIf="onDisplayLoansDemands">
          <thead>
            <tr>
              <th>No.</th>
              <th>Account Id</th>
              <th>Next Repayment Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of this.not_demanded, let i = index">
              <td>{{i + 1}}</td>
              <td>{{item.acid}}</td>
              <td>{{item.next_repayment_date | date: "dd-MM-yyyy"}}</td>
            </tr>
          </tbody>
        </table>
      </mat-tab>
      <mat-tab class="mat-tab container-fluid" label="DEMANDS SATISFACTION">
        <mat-tab-group mat-align-tabs="center">
          <mat-tab class="mat-tab container-fluid" label="SATISFIED LOAN DEMANDS">
            <br>
            <div class="row">
              <div class="col-md-6 col-sm-12">
                <div class="form-group">
                  <div class="col-md-6 col-sm-12 form-column">
                    <label for="" class="start">Choose Date<span class="warning">*</span></label>
                  </div>
                  <div class="col-md-6 col-sm-12 form-column">
                    <input [matDatepicker]="satisfactionDate" class="form-control" (dateChange)="loanDateEvent($event)"
                      [ngModel]="date">
                    <mat-datepicker-toggle matSuffix [for]="satisfactionDate"></mat-datepicker-toggle>
                    <mat-datepicker #satisfactionDate></mat-datepicker>
                  </div>
                </div>
              </div>
              <div class="col-md-2 col-sm-12">
                <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getDemands()">
                  SUBMIT
                </button>
              </div>
            </div>
            <br>
            <mat-divider></mat-divider>
            <br>
            <h4><strong class="text-center" *ngIf="onDisplaySatisfaction">LOAN DEMANDS RECORDS SATISFIED</strong></h4>
            <table class="table table-striped table-bordered table-sm row-border hover" style="width: 100%;">
              <thead>
                <tr>
                  <th>No.</th>
                  <th>Account Id</th>
                  <th>Account Name</th>
                  <th>Demand Amount</th>
                  <th>Amount Satisfied</th>
                  <th>Loan Remaining Balance</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of this.demandEvents, let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{item.accountId}}</td>
                  <td>{{item.accountName}}</td>
                  <td>{{item.demandAmount | currency: "UGX"}}</td>
                  <th>{{item.amountSatisfied | currency: "UGX"}}</th>
                  <th>{{item.loanRemainingBalance | currency: "UGX"}}</th>
                </tr>
              </tbody>
            </table>
          </mat-tab>
          <mat-tab class="mat-tab container-fluid" label="DEMANDS GENERATION">
            <br>
            <div class="row">
              <div class="col-md-6 col-sm-12">
                <div class="form-group">
                  <div class="col-md-6 col-sm-12 form-column">
                    <label for="" class="start">Demand Generation Date<span class="warning">*</span></label>
                  </div>
                  <div class="col-md-6 col-sm-12 form-column">
                    <input [matDatepicker]="generationDate" class="form-control" (dateChange)="loanDateEvent($event)"
                      [ngModel]="generation_date">
                    <mat-datepicker-toggle matSuffix [for]="generationDate"></mat-datepicker-toggle>
                    <mat-datepicker #generationDate></mat-datepicker>
                  </div>
                </div>
              </div>
              <div class="col-md-2 col-sm-12">
                <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="generateDemands()">
                  SUBMIT
                </button>
              </div>
            </div>
            <br>
            <mat-divider></mat-divider>
            <br>
            <h4 class="text-center" *ngIf="onDisplayGeneration"><strong>LOAN DEMANDS RECORDS GENERATED</strong></h4>
            <table class="table table-striped table-bordered table-sm row-border hover" style="width: 100%;">
              <thead>
                <tr>
                  <th>No.</th>
                  <th>Account Id</th>
                  <th>Account Name</th>
                  <th>Demand Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of this.generatedEventData, let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{item.accountId}}</td>
                  <td>{{item.accountName}}</td>
                  <td>{{item.demandAmount | currency: "UGX"}}</td>
                </tr>
              </tbody>
            </table>
          </mat-tab>
          <mat-tab class="mat-tab container-fluid" label="UNSATISFIED LOAN DEMANDS">
            <br>
            <h4 class="float-left"><strong>Loan Demands Satisfaction</strong></h4>
            <br>
            <h4 class="text-center"><strong>LOANS DEMANDS ACCOUNTS  GENERATED BUT NOT SATISFIED</strong></h4>
            <table class="table table-striped table-bordered table-sm row-border hover" style="width: 100%;">
              <thead>
                <tr>
                  <th>No.</th>
                  <th>Account Id</th>
                  <th>Demanded On</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of this.demand_res, let i = index">
                  <td>{{i + 1}}</td>
                  <td>{{item.acid}}</td>
                  <td>{{item.created_on}}</td>
                </tr>
              </tbody>
            </table>
          </mat-tab>
        </mat-tab-group>
      </mat-tab>
      <mat-tab class="mat-tab container-fluid" label="LOAN DISBURMENT">
        <br>
        <h4 class="float-left"><strong>Loan Disbursment Deatils For Account {{this.account_id}}</strong></h4>
        <form class="form" [formGroup]="formData" #resetRequestsForm="ngForm" novalidate>
          <div class="row">
        <div class="col-md-6 col-sm-12">
          <div class="form-group">
              <div class="col-md-6 col-sm-12 form-column">
                  <label class="start pull-left">Loan Account ID<span class="warning">*</span></label>
              </div>
              <div class="col-md-6 col-sm-12 form-column ">
                  <input type="text" formControlName="account_code" class="pull-right form-control"

                      [ngClass]="{ 'is-invalid': submitted && f.account_code.errors }"
                      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                      maxlength="20" minlength="4"/> &nbsp; &nbsp;
                  <mat-icon color="primary" (click)="loansAccountLookUp()">search</mat-icon>
              </div>
          </div>
      </div>
      <div class="col-md-2 col-sm-12">
        <button type="button" class="btn btn-primary btn-sm pull-right btn" (click)="getDisbursmentInfor()">
          SUBMIT
        </button>
      </div>
      </div>
      </form>
        <br>
        <mat-divider *ngIf="onDisplayDisbursementInfor"></mat-divider>
        <br>
        <h4 class="text-center" *ngIf="onDisplayDisbursementInfor"><strong>LOAN ACCOUNT:- {{this.account_id}} DISBURMENT INFORMATION</strong></h4>
        <table class="table table-striped table-bordered table-sm row-border hover" style="width: 100%;"
          *ngIf="onDisplayDisbursementInfor">
          <thead>
            <tr>
              <th>No.</th>
              <th>Debit Account</th>
              <th>Credit Account</th>
              <th>Amount</th>
              <th>T. Code</th>
              <th>T. Description</th>
              <th>T. Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of this.disbursment, let i = index">
              <td>{{i + 1}}</td>
              <td>{{item.debitAccount}}</td>
              <td>{{item.creditAccount}}</td>
              <td>{{item.amount}}</td>
              <td>{{item.transactionCode}}</td>
              <td>{{item.transactionDescription}}</td>
              <td>{{item.transactionStatus}}</td>
            </tr>
          </tbody>
        </table>
      </mat-tab>
    </mat-tab-group>
  </div>
</mat-card>
