<mat-card>
  <mat-card-header class="breadcrumb">
    <div>
      <a routerLink="/system">Dashboard / </a>
      <a routerLink="/system/transactions/standing/orders/maintenance">Standing Orders Maintenenace / </a>
      Standing Orders
    </div>
  </mat-card-header>
  <div *ngIf="loading">
    <p><small>Loading, please wait...</small></p>
    <p>
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </p>
  </div>
  <div *ngIf="isSubmitting">
    <p><small>Submitting Standing Order Data ...</small></p>
    <p>
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </p>
  </div>
  <div class="row">
    <div class="col-md-6 col-sm-12">
      <div class="row">
        <div class="col-md-6 col-sm-12">
          <h4>Function:- <strong>{{this.fmData.function_type}}</strong> </h4>
        </div>
        <div class="col-md-6 col-sm-12">
          <h4>Order Code:- <strong>{{this.fmData.standingOrderCode}}</strong></h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-sm-12 row" *ngIf="onShowResults">
      <div class="row" *ngIf="this.results">
        <div class="col-md-4 col-sm-12">
          <h4>Posted ON:- <strong>{{this.results.postedTime | date}}</strong></h4>
        </div>
        <div class="col-md-4 col-sm-12">
          <h4>Posted BY:- <strong>{{this.results.postedBy}}</strong></h4>
        </div>
        <div class="col-md-4 col-sm-12">
          <h4>Verification:- <strong>{{this.results.verifiedFlag}}</strong></h4>
        </div>
      </div>
    </div>
  </div>
  <mat-divider></mat-divider>
  <br>
  <div class="container-fluid">
    <br>
    <form action="" class="form" [formGroup]="formData" novalidate (ngSubmit)="onSubmit()">
      <mat-tab-group mat-align-tabs="center">
        <mat-tab class="mat-tab" label="General Details">
          <br>
          <div class="row">
            <div class="col-md-6 col-sm-12" *ngIf="applicationDate">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Application Date</label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input [matDatepicker]="applicationDate" formControlName="applicationDate" class="form-control">
                  <span *ngIf="onShowDate" color="primary">
                    <mat-datepicker-toggle matSuffix [for]="applicationDate"></mat-datepicker-toggle>
                  </span>
                  <mat-datepicker color="primary" #applicationDate></mat-datepicker>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Order Type<span class="warning" *ngIf="onShowWarning">*</span></label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <select formControlName="type" class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f.type.errors}">
                    <option value="" disabled>--SELECT ORDER TYPE--</option>
                    <option *ngFor="let item of typeArray" [value]="item">
                      {{item}}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12" *ngIf="status">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Status<span class="warning" *ngIf="onShowWarning">*</span></label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <select formControlName="status" class="form-control">
                    <option value="" disabled>--SELECT STATUS--</option>
                    <option *ngFor="let item of statusArray" [value]="item">
                      {{item}}</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Amount<span class="warning" *ngIf="onShowWarning">*</span></label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input type="number" formControlName="amount" class="form-control"

                    [ngClass]="{ 'is-invalid': submitted && f.amount.errors}"
                    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                    maxlength="12" minlength="2" />
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Source Account No.<span class="warning" *ngIf="onShowWarning"></span></label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input type="text" formControlName="sourceAccountNo" class="form-control"

                    [ngClass]="{ 'is-invalid': submitted && f.sourceAccountNo.errors}"
                    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                    maxlength="20" minlength="6" /> &nbsp;
                  <mat-icon color="primary" (click)="sourceAccountLookup()" *ngIf="onShowSearchIcon">search</mat-icon>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Customer Code<span class="warning" *ngIf="onShowWarning"></span></label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input readonly type="text" formControlName="customerCode" class="form-control"

                    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                    maxlength="15" minlength="4" />
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Allow Partial Deduction<span class="warning" *ngIf="onShowWarning">*</span></label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <mat-radio-group class="pull-right" aria-label="Select an option"
                    formControlName="allowPartialDeduction">
                    <mat-radio-button color="primary" value="YES">YES</mat-radio-button>
                    <mat-radio-button color="accent" value="NO">NO</mat-radio-button>
                  </mat-radio-group>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label class="start">Effective Start Date</label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input [matDatepicker]="effectiveStartDate" formControlName="effectiveStartDate" class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f.effectiveStartDate.errors}">
                  <span *ngIf="onShowDate" color="primary">
                    <mat-datepicker-toggle matSuffix [for]="effectiveStartDate"></mat-datepicker-toggle>
                  </span>
                  <mat-datepicker color="primary" #effectiveStartDate></mat-datepicker>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label class="start">End Date</label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input [matDatepicker]="endDate" formControlName="endDate" class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f.endDate.errors}">
                  <span *ngIf="onShowDate" color="primary">
                    <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                  </span>
                  <mat-datepicker color="primary" #endDate></mat-datepicker>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label>Duration-(Months)</label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input type="number" formControlName="duration" class="form-control"

                    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                    maxlength="4" minlength="1" />
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column">
                  <label class="start">Next Run Date</label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <input [matDatepicker]="nextRunDate" formControlName="nextRunDate" class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f.nextRunDate.errors}">
                  <span *ngIf="onShowDate" color="primary">
                    <mat-datepicker-toggle matSuffix [for]="nextRunDate"></mat-datepicker-toggle>
                  </span>
                  <mat-datepicker color="primary" #nextRunDate></mat-datepicker>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-12">
              <div class="form-group">
                <div class="col-md-4 col-sm-12 form-column ">
                  <label>Description</label>
                </div>
                <div class="col-md-8 col-sm-12 form-column">
                  <textarea type="text" class="form-control" formControlName="description"

                    [ngClass]="{ 'is-invalid': submitted && f.description.errors }"
                    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                    maxlength="120" minlength="2"></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 col-sm-12">
              <button mat-raised-button type="submit" class="pull-left bg-secondary text-white"
                routerLink="/system/">BACK</button>
            </div>
          </div>
        </mat-tab>
        <mat-tab class="mat-tab" label="Standing Order Destination">
          <br>
          <form action="" class="form" [formGroup]="destinationForm" *ngIf="ondestinationForm">
            <div class="row">
              <div class="col-md-6 col-sm-12">
                <div class="form-group">
                  <div class="col-md-4 col-sm-12 form-column">
                    <label>Destination Account No.</label>
                  </div>
                  <div class="col-md-8 col-sm-12 form-column">
                    <input type="text" formControlName="destinationAccountNo" class="form-control"

                      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                      maxlength="20" minlength="6" /> &nbsp;
                    <mat-icon color="primary" (click)="destinationAccountLookup()"
                      *ngIf="onShowSearchIcon">search</mat-icon>
                  </div>
                </div>
              </div>
              <div class="col-md-6 col-sm-12">
                <div class="form-group">
                  <div class="col-md-4 col-sm-12 form-column">
                    <label>Amount</label>
                  </div>
                  <div class="col-md-8 col-sm-12 form-column">
                    <input type="text" formControlName="amount" class="form-control"

                      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                      maxlength="12" minlength="2" />
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="showButtons">
              <button *ngIf="addButton" (click)="addDestinations()" class="pull-right btn btn-success btn-sm"
                [disabled]="!destinationForm.valid || disableAddButton" mat-raised-button color="primary" type="button">
                Add Destination
              </button>
              <button *ngIf="editButton" (click)="updateDestinations()" class="pull-right btn btn-primary btn-sm"
                [disabled]="!destinationForm.valid || disableAddButton" mat-raised-button color="primary" type="button">
                Update Destination
              </button>
            </div>
          </form>
          <div class="row table-action-row">
            <div class="on-mobile-hide col-md-6 col-sm-12">
              <strong>Standing Order Destinations List</strong>
            </div>
            <div class="col-md-6 col-sm-12">
              <input class="pull-right search form-control" (keyup)="applyFilter($event)" placeholder="Search..."
                #input />
            </div>
          </div>
          <div class="table-row">
            <table  mat-table matSort matTableExporter [dataSource]="dataSource">
              <ng-container matColumnDef="index">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> # </th>
                <td mat-cell *matCellDef="let element; let i = index">{{i + 1}}</td>
              </ng-container>
              <ng-container matColumnDef="standingOrderCode">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>St. Order Code</th>
                <td mat-cell *matCellDef="let row">{{ row.standingOrderCode}}</td>
              </ng-container>
              <ng-container matColumnDef="destinationAccountNo">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Destination Acc.
                <td mat-cell *matCellDef="let row">{{ row.destinationAccountNo}}</td>
              </ng-container>
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Amount</th>
                <td mat-cell *matCellDef="let row">{{ row.amount }}</td>
              </ng-container>
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Action</th>
                <td mat-cell *matCellDef="let row">
                  <button mat-icon-button [disabled]="disableActions" color="primary" (click)="editItem(row)">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button [disabled]="disableActions" (click)="deleteItem(row)" color="warn">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
              </tr>
            </table>
          </div>
          <mat-paginator [pageSizeOptions]="[7, 20, 30, 40, 50, 100]" aria-label="Select page"></mat-paginator>
          <br>
          <hr>
          <button mat-raised-button type="submit" class="pull-left bg-secondary text-white"
            routerLink="/system/transactions/standing/orders/maintenance">BACK</button>
          <button *ngIf="!hideBtn" (click)="onSubmit()" class="pull-right" mat-raised-button [color]="btnColor"
            type="submit">
            <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>{{btnText}}
          </button>
        </mat-tab>
      </mat-tab-group>
      <br>
    </form>
  </div>
</mat-card>
